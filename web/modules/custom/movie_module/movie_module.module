<?php

/**
 * Implements hook_preprocess_node().
 */
function movie_module_preprocess_node(array &$variables) {
  // Load the configuration setting for the budget amount.
  $config = \Drupal::config('movie_module.settings');
  $budget_amount = $config->get('budget');

  // Ensure we are on a node page and it's of type 'movie'.
  $node = $variables['node'];
  if ($node->bundle() == 'movie' && !empty($budget_amount)) {
    // Get the movie price from the field_movie_price field.
    $movie_price = $node->get('field_movie_price')->value;

    // Compare the budget amount with the movie price and set the appropriate message.
    if ($budget_amount > $movie_price) {
      $message = t('The movie is under budget.');
    } elseif ($budget_amount < $movie_price) {
      $message = t('The movie is over budget.');
    } else {
      $message = t('The movie is within budget.');
    }

    // Add the message to the content of the node.
    $variables['content']['movie_budget_message'] = [
      '#markup' => '<div class="movie-budget-message">' . $message . '</div>',
      '#cache' => [
        'tags' => ['message_data']
      ]
    ];
  }
}
